{% assign current_lang = page.lang | default: site.default_lang | default: "es" %}
{% assign alt_lang = current_lang == "es" ? "en" : "es" %}
<!DOCTYPE html>
<html lang="{{page.lang}}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>
    {% if current_lang == "es" %}
      {% if page.title %}{{ page.title }}{% else %}Clínica de Medicina Estética en Bogotá | Dra. Tatiana Leal{% endif %}
    {% else %}
      {% if page.title %}{{ page.title }}{% else %}Aesthetic Medicine Clinic in Bogotá | Dr. Tatiana Leal{% endif %}
    {% endif %}
  </title>

  <!-- Meta tags principales -->
  <meta name="description" content="{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  <meta name="robots" content="{% if page.noindex %}noindex, nofollow{% else %}index, follow{% endif %}">
  <!-- Agregar meta tags de seguridad -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <!-- Meta de geolocalización -->
  <meta name="country" content="COL">
  <meta name="geo.region" content="CO-CUN">
  <meta name="author" content="{% if page.autor %}{{ page.autor }}{% else %}{{ site.author.name }}{% endif %}">
  <meta name="copyright" content="{% if page.copyright %}{{ page.copyright }}{% else %}{{ site.name }}{% endif %}">
  <meta name="owner" content="Tatiana Leal">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="theme-color" content="#002e51">
  <meta name="google-site-verification" content="google8146e83ebc5c9d45">

  <!-- Manejo de idiomas y URLs canónicas -->
  {% assign current_lang = page.lang | default: site.default_lang %}
  {% assign pages=site.pages | where:"ref", page.ref | sort: 'lang' %}
  {% assign posts=site.posts | where:"ref", page.ref | sort: 'lang' %}
  {% assign faciales_es=site.tratamientos-faciales_es | where:"ref", page.ref | sort: 'lang' %}
  {% assign faciales_en=site.tratamientos-faciales_en | where:"ref", page.ref | sort: 'lang' %}
  {% assign corporales_es=site.tratamientos-corporales_es | where:"ref", page.ref | sort: 'lang' %}
  {% assign corporales_en=site.tratamientos-corporales_en | where:"ref", page.ref | sort: 'lang' %}
  {% assign intimos_es=site.tratamientos-intimos_es | where:"ref", page.ref | sort: 'lang' %}
  {% assign intimos_en=site.tratamientos-intimos_en | where:"ref", page.ref | sort: 'lang' %}
  {% assign tecnologia_es=site.tecnologia_es | where:"ref", page.ref | sort: 'lang' %}
  {% assign tecnologia_en=site.tecnologia_en | where:"ref", page.ref | sort: 'lang' %}
  {% assign all_pages = pages | concat: posts | concat: faciales_es | concat: faciales_en | concat: corporales_en | concat: corporales_es | concat: intimos_es | concat: intimos_en | concat: tecnologia_es | concat: tecnologia_en %}

  {% if page.redirect_to %}
    <link rel="canonical" href="{{ page.redirect_to | absolute_url }}">
  {% elsif page.canonical_url %}
    <link rel="canonical" href="{{ page.canonical_url | absolute_url }}">
  {% else %}
    <link rel="canonical" href="{{ site.url }}{{ page.url }}">
  {% endif %}

  <!-- Mejorar manejo de hreflang -->
  {% assign alt_langs = site.languages | where_exp: "lang", "lang != page.lang" %}
  {% for lang in alt_langs %}
    {% assign alt_page = site.pages | where: "ref", page.ref | where: "lang", lang | first %}
    {% if alt_page %}
      <link rel="alternate" hreflang="{{ lang }}" href="{{ site.url }}{{ alt_page.url }}">
    {% endif %}
  {% endfor %}
  <link rel="alternate" hreflang="x-default" href="{{ site.url }}/{{ site.default_lang }}/">

  <!-- RSS Feeds -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.name }} ES" href="{{ site.url }}/feed-es.xml">
  <link rel="alternate" type="application/rss+xml" title="{{ site.name }} EN" href="{{ site.url }}/feed-en.xml">
  <link rel="alternate" type="application/rss+xml" title="{{ site.name }} Treatments" href="{{ site.url }}/feed-treatments.xml">

  <!-- Meta tags para artículos -->
  {% if page.layout == 'post' %}
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
    <meta property="article:modified_time" content="{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}">
    {% if page.category %}
      <meta property="article:section" content="{{ page.category }}">
    {% endif %}
    {% if page.tags %}
      <meta property="article:tag" content="{{ page.tags | join: ',' }}">
    {% endif %}
  {% endif %}

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:title" content="{% if page.h1 %}{{ page.h1 | strip_html }}{% else %}{{ page.title }}{% endif %}">
  <meta property="og:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:image" content="{% if page.jpg %}{{ page.jpg | absolute_url }}{% else %}{{ site.default_image | absolute_url }}{% endif %}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{% if page.alt %}{{ page.alt }}{% else %}{{ site.title }}{% endif %}">
  <meta property="og:locale" content="{{ current_lang }}_{{ current_lang | upcase }}">
  <meta property="og:site_name" content="{{ site.name }} {% if current_lang == 'es' %}Colombia{% else %}Colombia{% endif %}">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@dratatianaleal">
  <meta name="twitter:title" content="{{ page.title }}">
  <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta name="twitter:image" content="{% if page.jpg %}{{ page.jpg | absolute_url }}{% else %}{{ site.default_image | absolute_url }}{% endif %}">

  <!-- DNS Prefetch y Preconnect -->
  <link rel="dns-prefetch" href="//www.googletagmanager.com">
  <link rel="preconnect" href="https://maps.googleapis.com">
  <link rel="preconnect" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.google.com">
  <link rel="preconnect" href="https://www.gstatic.com">

  <!-- Favicon -->
  <link rel="icon" href="{{ 'img/favicon/favicon.ico' | relative_url }}" type="image/x-icon">
  <link rel="apple-touch-icon" href="{{ 'img/favicon/apple-touch-icon.png' | relative_url }}">

  <!-- Schemas -->
  {% include schema-treatments.html %}
  {% include schema-doctors.html %}
  {% include schema-blog.html %}

  <!-- Enlaces adicionales -->
  <link rel="author" href="/humans.txt">

  
  {% include critical-css/critical.html %}

  <link rel="preload" href="{{'css/fonts/lexend-deca-v21-latin-700.woff2' | relative_url}}" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="{{'css/fonts/dm-sans-v15-latin-regular.woff2' | relative_url}}" as="font" type="font/woff2" crossorigin>

  {% if page.layout == "servicios" %}
  <link rel="preload" as="image" href="{{ page.hero | relative_url }}" type="image/avif">
  {% endif %}

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M2G8W6JV');</script>
    <!-- End Google Tag Manager -->
  </head>
